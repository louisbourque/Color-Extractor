function FileDragHover(e){e.stopPropagation(),e.preventDefault(),app.dropTarget.className="dragover"==e.type?"hover":""}function FileSelectHandler(e){FileDragHover(e),app.error.innerHTML="",app.output.innerHTML="";for(var t,r=e.target.files||e.dataTransfer.files,o=0;t=r[o];o++)"image"!=t.type.substring(0,5)?app.error.innerHTML+="Unsupported file type: "+t.name+"<br>":loadImage(t)}function loadImage(e){var t=new FileReader;t.onload=function(e){var t=getImageHTML(e.target.result);app.output.appendChild(t);var r=t.getElementsByTagName("img")[0],o=t.getElementsByClassName("image-details")[0];addEvent(r,"load",function(){o.innerHTML=getImageDetails(r),document.documentElement.scrollTop=document.body.scrollTop=offset(app.output).top})},t.readAsDataURL(e)}function getImageHTML(e){var t=document.createElement("div");return t.className="image-div",t.innerHTML='<img src="'+e+'"><div class="image-details"></div>',t}function getImageDetails(e){var t=getPalette(e),r=[];r[0]=getPalette(e,0),r[1]=getPalette(e,1),r[2]=getPalette(e,2),r[3]=getPalette(e,3);var o=colorArrayToHex(t[0]),a='<div class="color-block-container primary"><div class="color-block-inner"><p>Primary: </p><div class="color-block primary '+(getBrightness(t[0])<90?"dark":"")+'" style="background-color:'+o+';">'+o+'</div><button title="Copy to clipboard" class="copy-button" data-hex="'+o+'"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path d="M2 13h4v1H2v-1zm5-6H2v1h5V7zm2 3V8l-3 3 3 3v-2h5v-2H9zM4.5 9H2v1h2.5V9zM2 12h2.5v-1H2v1zm9 1h1v2c-.02.28-.11.52-.3.7-.19.18-.42.28-.7.3H1c-.55 0-1-.45-1-1V4c0-.55.45-1 1-1h3c0-1.11.89-2 2-2 1.11 0 2 .89 2 2h3c.55 0 1 .45 1 1v5h-1V6H1v9h10v-2zM2 5h8c0-.55-.45-1-1-1H8c-.55 0-1-.45-1-1s-.45-1-1-1-1 .45-1 1-.45 1-1 1H3c-.55 0-1 .45-1 1z"></path></svg></button></div></div>';a+='<div class="color-background-gradient" style="background-image: linear-gradient(to right, '+colorArrayToHex(r[0][0])+" 0%, "+colorArrayToHex(r[1][0])+" 50%, "+colorArrayToHex(r[2][0])+" 75%, "+colorArrayToHex(r[3][0])+' 100%);"><button title="Copy to clipboard" class="copy-button" data-hex="background-image: url(path/to/img.jpg), linear-gradient(to right, '+colorArrayToHex(r[0][0])+" 0%, "+colorArrayToHex(r[1][0])+" 50%, "+colorArrayToHex(r[2][0])+" 75%, "+colorArrayToHex(r[3][0])+' 100%);"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path d="M2 13h4v1H2v-1zm5-6H2v1h5V7zm2 3V8l-3 3 3 3v-2h5v-2H9zM4.5 9H2v1h2.5V9zM2 12h2.5v-1H2v1zm9 1h1v2c-.02.28-.11.52-.3.7-.19.18-.42.28-.7.3H1c-.55 0-1-.45-1-1V4c0-.55.45-1 1-1h3c0-1.11.89-2 2-2 1.11 0 2 .89 2 2h3c.55 0 1 .45 1 1v5h-1V6H1v9h10v-2zM2 5h8c0-.55-.45-1-1-1H8c-.55 0-1-.45-1-1s-.45-1-1-1-1 .45-1 1-.45 1-1 1H3c-.55 0-1 .45-1 1z"></path></svg></button>background-image: url(path/to/img.jpg),<br>linear-gradient(to right, '+colorArrayToHex(r[0][0])+" 0%, "+colorArrayToHex(r[1][0])+" 50%, "+colorArrayToHex(r[2][0])+" 75%, "+colorArrayToHex(r[3][0])+" 100%);</div>";for(var i=1;i<t.length;i++)o=colorArrayToHex(t[i]),a+='<div class="color-block-container"><div class="color-block-inner"><div class="color-block '+(getBrightness(t[i])<90?"dark":"")+'" style="background-color:'+o+';">'+o+'</div><button title="Copy to clipboard" class="copy-button" data-hex="'+o+'"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path d="M2 13h4v1H2v-1zm5-6H2v1h5V7zm2 3V8l-3 3 3 3v-2h5v-2H9zM4.5 9H2v1h2.5V9zM2 12h2.5v-1H2v1zm9 1h1v2c-.02.28-.11.52-.3.7-.19.18-.42.28-.7.3H1c-.55 0-1-.45-1-1V4c0-.55.45-1 1-1h3c0-1.11.89-2 2-2 1.11 0 2 .89 2 2h3c.55 0 1 .45 1 1v5h-1V6H1v9h10v-2zM2 5h8c0-.55-.45-1-1-1H8c-.55 0-1-.45-1-1s-.45-1-1-1-1 .45-1 1-.45 1-1 1H3c-.55 0-1 .45-1 1z"></path></svg></button></div></div>';return a}function colorArrayToHex(e){return e.reduce(function(e,t){return e+(t<16?"0"+t.toString(16):t.toString(16))},"#")}function getBrightness(e){return(299*e[0]+587*e[1]+114*e[2])/1e3}var app=app||{};app.fileselect=document.getElementById("file-select-input"),app.error=document.getElementById("error"),app.output=document.getElementById("output"),app.dropTarget=document.getElementById("filedrag"),window.File&&window.FileList&&window.FileReader&&(app.fileselect.addEventListener("change",FileSelectHandler,!1),document.addEventListener("dragover",FileDragHover,!1),document.addEventListener("dragleave",FileDragHover,!1),document.addEventListener("drop",FileSelectHandler,!1),document.getElementById("filedrag").style.display="block",live("button.copy-button","click",function(e){copyTextToClipboard(e.target.getAttribute("data-hex"))}));
function addEvent(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n)}function removeEvent(e,t,n){e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n)}function offset(e){var t=e.getBoundingClientRect(),n=window.pageXOffset||document.documentElement.scrollLeft,o=window.pageYOffset||document.documentElement.scrollTop;return{top:t.top+o,left:t.left+n}}function live(e,t,n,o){addEvent(o||document,t,function(t){var l=(o||document).querySelectorAll(e);if(l){for(var d=t.target||t.srcElement,c=-1;d&&(c=Array.prototype.indexOf.call(l,d))===-1;)d=d.parentElement;c>-1&&n.call(d,t)}})}function copyTextToClipboard(e){var t=document.createElement("textarea");t.style.position="fixed",t.style.top=0,t.style.left=0,t.style.width="2em",t.style.height="2em",t.style.padding=0,t.style.border="none",t.style.outline="none",t.style.boxShadow="none",t.style.background="transparent",t.value=e,document.body.appendChild(t),t.select();try{document.execCommand("copy")}catch(e){}document.body.removeChild(t)}
function getPalette(r,n){var t=5,o=14,e=document.createElement("canvas"),u=e.getContext("2d");document.body.appendChild(e);var a=e.width=r.width,i=e.height=r.height;u.drawImage(r,0,0,a,i);var f;f="undefined"!=typeof n?u.getImageData(Math.floor(a/4*n),0,Math.floor(a/4),i).data:u.getImageData(0,0,a,i).data;for(var c,v,p,s,l,h=a*i,g=[],b=0;b<h;b+=t)c=4*b,v=f[c+0],p=f[c+1],s=f[c+2],l=f[c+3],l>=125&&(v>250&&p>250&&s>250||g.push([v,p,s]));var m=MMCQ.quantize(g,o),d=m?m.palette():null;return e.parentNode.removeChild(e),d}if(!pv)var pv={map:function(r,n){var t={};return n?r.map(function(r,o){return t.index=o,n.call(t,r)}):r.slice()},naturalOrder:function(r,n){return r<n?-1:r>n?1:0},sum:function(r,n){var t={};return r.reduce(n?function(r,o,e){return t.index=e,r+n.call(t,o)}:function(r,n){return r+n},0)},max:function(r,n){return Math.max.apply(null,n?pv.map(r,n):r)}};var MMCQ=function(){function r(r,n,t){return(r<<2*f)+(n<<f)+t}function n(r){function n(){t.sort(r),o=!0}var t=[],o=!1;return{push:function(r){t.push(r),o=!1},peek:function(r){return o||n(),void 0===r&&(r=t.length-1),t[r]},pop:function(){return o||n(),t.pop()},size:function(){return t.length},map:function(r){return t.map(r)},debug:function(){return o||n(),t}}}function t(r,n,t,o,e,u,a){var i=this;i.r1=r,i.r2=n,i.g1=t,i.g2=o,i.b1=e,i.b2=u,i.histo=a}function o(){this.vboxes=new n(function(r,n){return pv.naturalOrder(r.vbox.count()*r.vbox.volume(),n.vbox.count()*n.vbox.volume())})}function e(n){var t,o,e,u,a=1<<3*f,i=new Array(a);return n.forEach(function(n){o=n[0]>>c,e=n[1]>>c,u=n[2]>>c,t=r(o,e,u),i[t]=(i[t]||0)+1}),i}function u(r,n){var o,e,u,a=1e6,i=0,f=1e6,v=0,p=1e6,s=0;return r.forEach(function(r){o=r[0]>>c,e=r[1]>>c,u=r[2]>>c,o<a?a=o:o>i&&(i=o),e<f?f=e:e>v&&(v=e),u<p?p=u:u>s&&(s=u)}),new t(a,i,f,v,p,s,n)}function a(n,t){function o(r){var n,o,e,u,a,i=r+"1",c=r+"2",v=0;for(f=t[i];f<=t[c];f++)if(h[f]>l/2){for(e=t.copy(),u=t.copy(),n=f-t[i],o=t[c]-f,a=n<=o?Math.min(t[c]-1,~~(f+o/2)):Math.max(t[i],~~(f-1-n/2));!h[a];)a++;for(v=g[a];!v&&h[a-1];)v=g[--a];return e[c]=a,u[i]=e[c]+1,[e,u]}}if(t.count()){var e=t.r2-t.r1+1,u=t.g2-t.g1+1,a=t.b2-t.b1+1,i=pv.max([e,u,a]);if(1==t.count())return[t.copy()];var f,c,v,p,s,l=0,h=[],g=[];if(i==e)for(f=t.r1;f<=t.r2;f++){for(p=0,c=t.g1;c<=t.g2;c++)for(v=t.b1;v<=t.b2;v++)s=r(f,c,v),p+=n[s]||0;l+=p,h[f]=l}else if(i==u)for(f=t.g1;f<=t.g2;f++){for(p=0,c=t.r1;c<=t.r2;c++)for(v=t.b1;v<=t.b2;v++)s=r(c,f,v),p+=n[s]||0;l+=p,h[f]=l}else for(f=t.b1;f<=t.b2;f++){for(p=0,c=t.r1;c<=t.r2;c++)for(v=t.g1;v<=t.g2;v++)s=r(c,v,f),p+=n[s]||0;l+=p,h[f]=l}return h.forEach(function(r,n){g[n]=l-r}),o(i==e?"r":i==u?"g":"b")}}function i(r,t){function i(r,n){for(var t,o=1,e=0;e<v;)if(t=r.pop(),t.count()){var u=a(f,t),i=u[0],c=u[1];if(!i)return;if(r.push(i),c&&(r.push(c),o++),o>=n)return;if(e++>v)return}else r.push(t),e++}if(!r.length||t<2||t>256)return!1;var f=e(r),c=0;f.forEach(function(){c++});var s=u(r,f),l=new n(function(r,n){return pv.naturalOrder(r.count(),n.count())});l.push(s),i(l,p*t);for(var h=new n(function(r,n){return pv.naturalOrder(r.count()*r.volume(),n.count()*n.volume())});l.size();)h.push(l.pop());i(h,t-h.size());for(var g=new o;h.size();)g.push(h.pop());return g}var f=5,c=8-f,v=1e3,p=.75;return t.prototype={volume:function(r){var n=this;return n._volume&&!r||(n._volume=(n.r2-n.r1+1)*(n.g2-n.g1+1)*(n.b2-n.b1+1)),n._volume},count:function(n){var t=this,o=t.histo;if(!t._count_set||n){var e,u,a,i=0;for(e=t.r1;e<=t.r2;e++)for(u=t.g1;u<=t.g2;u++)for(a=t.b1;a<=t.b2;a++)index=r(e,u,a),i+=o[index]||0;t._count=i,t._count_set=!0}return t._count},copy:function(){var r=this;return new t(r.r1,r.r2,r.g1,r.g2,r.b1,r.b2,r.histo)},avg:function(n){var t=this,o=t.histo;if(!t._avg||n){var e,u,a,i,c,v=0,p=1<<8-f,s=0,l=0,h=0;for(u=t.r1;u<=t.r2;u++)for(a=t.g1;a<=t.g2;a++)for(i=t.b1;i<=t.b2;i++)c=r(u,a,i),e=o[c]||0,v+=e,s+=e*(u+.5)*p,l+=e*(a+.5)*p,h+=e*(i+.5)*p;v?t._avg=[~~(s/v),~~(l/v),~~(h/v)]:t._avg=[~~(p*(t.r1+t.r2+1)/2),~~(p*(t.g1+t.g2+1)/2),~~(p*(t.b1+t.b2+1)/2)]}return t._avg},contains:function(r){var n=this,t=r[0]>>c;return gval=r[1]>>c,bval=r[2]>>c,t>=n.r1&&t<=n.r2&&gval>=n.g1&&gval<=n.g2&&bval>=n.b1&&bval<=n.b2}},o.prototype={push:function(r){this.vboxes.push({vbox:r,color:r.avg()})},palette:function(){return this.vboxes.map(function(r){return r.color})},size:function(){return this.vboxes.size()},map:function(r){for(var n=this.vboxes,t=0;t<n.size();t++)if(n.peek(t).vbox.contains(r))return n.peek(t).color;return this.nearest(r)},nearest:function(r){for(var n,t,o,e=this.vboxes,u=0;u<e.size();u++)t=Math.sqrt(Math.pow(r[0]-e.peek(u).color[0],2)+Math.pow(r[1]-e.peek(u).color[1],2)+Math.pow(r[2]-e.peek(u).color[2],2)),(t<n||void 0===n)&&(n=t,o=e.peek(u).color);return o},forcebw:function(){var r=this.vboxes;r.sort(function(r,n){return pv.naturalOrder(pv.sum(r.color),pv.sum(n.color))});var n=r[0].color;n[0]<5&&n[1]<5&&n[2]<5&&(r[0].color=[0,0,0]);var t=r.length-1,o=r[t].color;o[0]>251&&o[1]>251&&o[2]>251&&(r[t].color=[255,255,255])}},{quantize:i}}();